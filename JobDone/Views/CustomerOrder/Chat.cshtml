@model CustomerSellerMessageViewModel
@{
    Layout = "~/Views/Shared/_CustomerLayout.cshtml";
}
<!DOCTYPE html>
<html lang="en">
    <haed>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/CustomerChat/stylee.css">
    <link rel='stylesheet' href='/CustomerChat/styleee.css'>
    <link rel="stylesheet" href="/CustomerChat/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
        <style>
            .get-started-btn {
                color: black;
                border-radius: 4px;
                padding: 7px 25px 8px 25px;
                white-space: nowrap;
                transition: 0.3s;
                font-size: 14px;
                display: inline-block;
                border: 2px solid #ffc451;
            }

                .get-started-btn:hover {
                    background: #ffbb38;
                    color: #343a40;
                }

            @@media (max-width: 992px) {
                .get-started-btn {
                    padding: 7px 20px 8px 20px;
                    margin-right: 15px;
                }
            }

        </style>
    </haed>
    <body>
        <div class="container" style="margin-top:100px;">
            <div id="chatContainerContainer">
                <div class="chat" id="chatContainer" style="width: 100%;">
                    @Html.Partial("_CustomerChatPartial", Model)
                </div>
            </div>
            <div class="chat" style="height:70px;width:100%;">
                <div class="messages" id="chat">
                    <form method="post" asp-action="Chat" id="sendMessageForm">
                        <div class="input">
                            <input hidden name="customerId" value="@Model.Customer.Id" />
                            <input hidden name="sellerId" value="@Model.Seller.Id" />
                            <input id="content" name="content" placeholder="Type your message here!" type="text" />
                        <input type="submit" value="send" style="width: 50px;background-color:#ffbb38; color:white; padding: 5px 10px;" />
                        </div>
                    </form>
                </div>
            </div>
            <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js'></script>
            <script src='https://code.jquery.com/jquery-3.6.0.min.js'></script>
            <script>
                function saveScrollPosition() {
                    return $('#chat').scrollTop();
                }

                function restoreScrollPosition(scrollPosition) {
                    $('#chat').scrollTop(scrollPosition);
                }

                function updateChatContent() {
                    var customerId = @Model.Customer.Id;
                    var sellerId = @Model.Seller.Id;
                    var savedScrollPosition = saveScrollPosition();

                    $.ajax({
                        url: "/CustomerOrder/GetAllMessages",
                        type: "GET",
                        data: { customerId: customerId, sellerId: sellerId }
                    })
                        .done(function (data) {
                            $('#chatContainer').html(data);
                            restoreScrollPosition(savedScrollPosition);
                        })
                        .fail(function () {
                            console.log('Error occurred while updating chat content.');
                        });
                }

                updateChatContent();

                $(function () {
                    $('form#sendMessageForm').submit(function (event) {
                        event.preventDefault(); 

                        var contentInput = $('#content');
                        var content = contentInput.val().trim(); 

                        if (content !== '') {
                            var savedScrollPosition = saveScrollPosition();
                            var formData = $(this).serialize(); 

                            $.ajax({
                                url: $(this).attr('action'),
                                type: 'POST',
                                data: formData,
                                beforeSend: function () {
                                    $('input[type="submit"]').prop('disabled', true);
                                },
                                success: function (result) {
                                    restoreScrollPosition(savedScrollPosition);
                                    updateChatContent();
                                },
                                error: function (xhr, status, error) {
                                    console.log(error);
                                },
                                complete: function () {
                                    $('input[type="submit"]').prop('disabled', false);
                                }
                            });

                            contentInput.val('');
                        }
                    });
                });
                setInterval(updateChatContent, 5000);
            </script>
        </div>
    </body>
</html>